@model ConsommiTounsi.Models.Product


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">

<div class="modal fade show" id="exampleModalScrollable" tabindex="-1" role="dialog" aria-labelledby="exampleModalScrollableTitle" style="padding-right: 16px; display: block;" aria-modal="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title mt-0" id="exampleModalScrollableTitle">Add product</h5>
                <button type="button" class="btn-close" data-sm-dismiss="modal" aria-label="Close">
                </button>
            </div>
           

                            <div class="modal-body p-4">
                                <form id="addForm" class="needs-validation was-validated" novalidate="" method="post" enctype="multipart/form-data">

                                    <div class="row">
                                        <div class="mb-3">
                                            <label class="form-label" for="validationCustom01">ProductName</label>
                                            <input type="text" class="form-control" id="NameProduct" placeholder="Enter Title" value="" required="">
                                            <div class="valid-feedback">
                                                Looks good!
                                            </div>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label">Description</label>
                                            <div>
                                                <textarea required="" id="DescriptionProduct" class="form-control parsley-error" rows="5" data-parsley-id="21" aria-describedby="parsley-id-21"></textarea>
                                                <div class="valid-feedback">
                                                    Looks good!
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label" for="validationCustom01">SellPrice</label>
                                                <input type="text" class="form-control" id="SellPriceProduct" placeholder="Enter Adress" value="" required="">
                                                <div class="valid-feedback">
                                                    Looks good!
                                                </div>
                                            </div>
                                        </div>


                                        <div class="col-12">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label" for="validationCustom01">BarCode</label>
                                                    <input type="text" class="form-control" name="BareCodeProduct"
                                                           id="BarCodeProduct" placeholder="Enter Adress" value="" required="">
                                                    <div class="valid-feedback">
                                                        Looks good!
                                                    </div>
                                                </div>
                                            </div>


                                        </div>
                                        <div class="mb-3">
                                            <input type="file" id="imageProduct" name="image" />
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="mb-3">
                                                    <div class="form-check">
                                                        <input type="checkbox" class="form-check-input" id="invalidCheck" required="">
                                                        <label class="form-check-label" for="invalidCheck">Agree to terms and conditions</label>
                                                        <div class="invalid-feedback">
                                                            You must agree before submitting.
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                        <div class="form-group">

                                            <div class="col-md-10">
                                                @if ( !String.IsNullOrEmpty(ViewBag.qrCodeImagePath))
                                                {
                                                    <img src="@Url.Content(ViewBag.qrCodeImagePath)" alt="Image" />
                                                }

                                            </div>

                                            <button id="btnAddProduct" class="btn btn-primary" type="button">Create Proudct</button>








</form>
                            </div>

        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>

<script>

    $('#btnAddProduct').click(function () {


        $('#addForm').serialize();

;



        //Initiliaze inputs
       
        var productName = $("#NameProduct").val();
        var Description = $("#DescriptionProduct").val();
        var SellPrice = parseFloat($("#SellPriceProduct").val());
        var NewProduct = true;
        var BarCode = $("#BarCodeProduct").val();
        var CreatedAt = moment().format(); 

        var MostViewed = 0;
        var PromotionEtat = false;


        if (productName == "") {
            alert('productName required');
            return;
        }
        if (Description == "") {
            alert('Description required');
            return;
        }
        if (SellPrice.length==0) {
            alert('SellPrice required');
            return;
        }
        if (BarCode == "") {
            alert('BarCode required');
            return;
        }
       



        var prJson = {
            productName: productName,
            description: Description,
            sellPrice: SellPrice,
            newProduct: NewProduct,
            barCode: BarCode,
            createdAt: CreatedAt,
            mostViewed: MostViewed ,
            promotionEtat: PromotionEtat,
            imageBareCode: BarCode

        }

        //file
        var formdata = new FormData();
        var filename = $('input[type=file]').val().replace(/C:\\fakepath\\/i, '')

        var file = $("#imageProduct").val();
        var convert = [];

        for (var i = 0; i < filename.length; i++) {
            convert.push(filename.charCodeAt(i));
        }

        formdata.append("picture", filename);
        formdata.append("prJson", JSON.stringify(prJson));
        formdata.append("BareCodeProduct", BarCode);





        for (var pair in formdata.entries()) {
            console.log(pair[0]);
            console.log(pair[1]);
        }
        $.ajax({
            type: "POST",
            url: '/Product/CreateProductAsync',
            data: formdata,
            cache: false,
            contentType: false,
            processData: false,
            success: function (data) {
                if (data.response) {
                    swal("Error!", "Duplicated BareCode" + data.response);

                }
            
                else  if(data.response1){
                    swal({
                        title: 'Good Job',
                        text: "Product has been saved !",
                        type: 'success'

                    }).then(function () {

                        $('#exampleModalScrollable').modal('hide');
                        setInterval('refreshPage()', 2000);


                    });


                }
                
                else {
                    swal("Error!", "bad request"+data.response);

                }

            },

 
            error:function(request, status, error) {
                alert(request.responseText);
            }
        });



    })
    function refreshPage() {
        location.reload(true);
    }

</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

